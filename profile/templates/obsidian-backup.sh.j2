#!/bin/bash

SOURCE="/Users/{{ obsidian_backup_user }}/Library/Mobile Documents/iCloud~md~obsidian/Documents"
DESTINATION="/Volumes/SSH/backups/obsidian"

set -eo pipefail

main() {

  local TIME

  TIME="$(date +%Y-%m-%d)"
  mkdir -p "${DESTINATION}"

  pushd "${SOURCE}/.." >> /dev/null
  echo "> Creating ${DESTINATION}/${TIME}.tar.gz ..."
  tar czf "${DESTINATION}/${TIME}.tar.gz" Documents
  echo "< ${DESTINATION}/${TIME}.tar.gz Complete!"
  popd >> /dev/null

  find "${DESTINATION}" -type f -mtime +10 -delete

}

main "$@"
